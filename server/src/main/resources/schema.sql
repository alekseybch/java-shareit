CREATE TABLE IF NOT EXISTS users
(
    id      BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name    VARCHAR(70) NOT NULL,
    email   VARCHAR(254) NOT NULL,
    CONSTRAINT PK_USER PRIMARY KEY (id),
    CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS item_requests
(
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    description     VARCHAR(200) NOT NULL,
    requestor_id    BIGINT NOT NULL,
    created         TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    CONSTRAINT PK_ITEM_REQUESTS PRIMARY KEY (id),
    CONSTRAINT ITEM_REQUESTS_USERS_FK
    FOREIGN KEY (requestor_id) REFERENCES users (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS items
(
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name            VARCHAR(70) NOT NULL,
    description     VARCHAR(200) NOT NULL,
    is_available    BOOLEAN NOT NULL,
    owner_id        BIGINT NOT NULL,
    request_id      BIGINT,
    CONSTRAINT PK_ITEM PRIMARY KEY (id),
    CONSTRAINT ITEMS_USERS_FK
    FOREIGN KEY (owner_id) REFERENCES users (id) ON DELETE CASCADE,
    CONSTRAINT ITEMS_REQUESTS_FK
    FOREIGN KEY (request_id) REFERENCES item_requests (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS bookings
(
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    start_date    TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    end_date      TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    item_id       BIGINT NOT NULL,
    booker_id     BIGINT NOT NULL,
    status        VARCHAR(8) NOT NULL,
    CONSTRAINT PK_BOOKING PRIMARY KEY (id),
    CONSTRAINT BOOKINGS_ITEMS_FK
    FOREIGN KEY (item_id) REFERENCES items (id) ON DELETE CASCADE,
    CONSTRAINT BOOKINGS_USERS_FK
    FOREIGN KEY (booker_id) REFERENCES users (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS comments
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    text        VARCHAR(500) NOT NULL,
    item_id     BIGINT NOT NULL,
    author_id   BIGINT NOT NULL,
    created     TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    CONSTRAINT PK_COMMENT PRIMARY KEY (id),
    CONSTRAINT COMMENTS_ITEMS_FK
    FOREIGN KEY (item_id) REFERENCES items (id) ON DELETE CASCADE,
    CONSTRAINT COMMENTS_USERS_FK
    FOREIGN KEY (author_id) REFERENCES users (id) ON DELETE CASCADE
);